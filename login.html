<html>

<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <script src="js/script.js" type="text/javascript" charset="utf-8"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <meta name="google-signin-client_id" content="101761782700-g2hn0s9u27u6tejuc2gvg43qb4rekq33.apps.googleusercontent.com">

</head>

<body bgcolor="black">

    <style type="text/css">

        body {

            background: black;

            color: crimson;

        }

        .g-signIn2 {

            margin-top: 50%;

            margin-left: 50%;

        }

        .data {

            display: none;

        }

        .fb-btn {

            margin-top: 20px;

        }

        #profile,

        #logout,

        #feed {

            display: none;

        }

    </style>

    <script>

        window.fbAsyncInit = function() {

            FB.init({

                appId: '865702130899004',

                cookie: true,

                xfbml: true,

                version: 'v2.8'

            });

            FB.getLoginStatus(function(response) {

                statusChangeCallback(response);

            });

        };

        (function(d, s, id) {

            var js, fjs = d.getElementsByTagName(s)[0];

            if (d.getElementById(id)) { return; }

            js = d.createElement(s);

            js.id = id;

            js.src = "//connect.facebook.net/en_US/sdk.js";

            fjs.parentNode.insertBefore(js, fjs);

        }(document, 'script', 'facebook-jssdk'));

        function statusChangeCallback(response) {

            if (response.status === 'connected') {

                console.log('Logged in and authenticated');

                alert('Logged in and authenticated')

                setElements(true);

                testAPI()

            } else {

                console.log('Please Login');

                setElements(false);

            }

        }

        function checkLoginState() {

            FB.getLoginStatus(function(response) {

                statusChangeCallback(response);

            });

        }

        function testAPI() {

            FB.api('/me?fields=name,email,birthday,location', function(response) {

                if (response && !response.error) {

                    //console.log(response);

                    buildProfile(response);

                }

                FB.api('/me/feed', function(response) {

                    if (response && !response.error) {

                        buildFeed(response);

                    }

                });

            })

        }

        function buildProfile(user) {

            let profile = `

          <h3>${user.name}</h3>

          <ul class="list-group">

            <li class="list-group-item">User ID: ${user.id}</li>

            <li class="list-group-item">Email: ${user.email}</li>

            <li class="list-group-item">Birthday: ${user.birthday}</li>

            <li class="list-group-item">Location: ${user.location.name}</li>

          </ul>

        `;

            document.getElementById('profile').innerHTML = profile;

        }

        function buildFeed(feed) {

            let output = '<h3>Latest Posts</h3>';

            for (let i in feed.data) {

                if (feed.data[i].message) {

                    output += `

              <div class="well">

                ${feed.data[i].message} <span>${feed.data[i].created_time}</span>

              </div>

            `;

                }

            }

            document.getElementById('feed').innerHTML = output;

        }

        function setElements(isLoggedIn) {

            if (isLoggedIn) {

                document.getElementById('logout').style.display = 'block';

                document.getElementById('profile').style.display = 'block';

                document.getElementById('feed').style.display = 'block';

                document.getElementById('fb-btn').style.display = 'none';

                document.getElementById('heading').style.display = 'none';

                document.getElementById('login').style.display = 'none';

            } else {

                document.getElementById('logout').style.display = 'none';

                document.getElementById('profile').style.display = 'none';

                document.getElementById('feed').style.display = 'none';

                document.getElementById('fb-btn').style.display = 'block';

                document.getElementById('heading').style.display = 'block';

                document.getElementById('login').style.display = 'block';

            }

        }

        function logout() {

            FB.logout(function(response) {

                setElements(false);

            });

        }

    </script>

    <nav class="navbar navbar-default">

        <div class="container">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">

                    <span class="sr-only">Toggle navigation</span>

                    <span class="icon-bar"></span>

                    <span class="icon-bar"></span>

                    <span class="icon-bar"></span>

                </button>

                <a class="navbar-brand" href="#">SocialAuth</a>

            </div>

            <div id="navbar" class="collapse navbar-collapse">

                <ul class="nav navbar-nav">

                    <li><a href="index.html">Home</a></li>

                </ul>

                <ul class="nav navbar-nav navbar-right">

                    <li><a id="logout" href="#" onclick="logout()">Logout</a></li>

                    <fb:login-button id="fb-btn" class ="fb-btn" scope="public_profile,email,user_birthday,user_location,user_posts" onlogin="checkLoginState();">

                    </fb:login-button>

                </ul>

            </div>

            <!--/.nav-collapse -->

        </div>

    </nav>

    <div class="container">

        <h3 id="heading">Log in to view your profile</h3>

        <div id="profile"></div>

        <div id="feed"></div>

    </div>

    <div class="login" id="login">

    <div class="g-signin2" data-onsuccess="onSignIn"></div>

    <fb:login-button class="fb-btn" scope="public_profile,email" onlogin="checkLoginState();">

    </fb:login-button>

    </div>

    <div class="data">

        <p>Profile</p>

        <img id="pic" class="img-circle" width="100" height="100" />

        <p>Email Address</p>

        <p id="email" class="alert alert-danger"></p>

        <a href="#" class="btn btn-danger" onclick="signOut();">Sign out</a>

    </div>

    <script>

        function signOut() {

            var auth2 = gapi.auth2.getAuthInstance();

            auth2.signOut().then(function() {

                alert("You have successfully signed out")

                console.log('User signed out.');

                $(".g-signin2").css("display", "block");

                $(".data").css("display", "none");

            });

        }

    </script>

</body>

</html>
